syntax = "proto3";

package api.retrieval;

import "google/api/annotations.proto";

option go_package = "retrieval/api/retrieval/v1;v1";
option java_multiple_files = true;
option java_package = "api.retrieval";

service Retrieval {
	rpc FindEvents(FindEventsRequest) returns (FindEventsReply) {
		option (google.api.http) = {
			post: "/api/v1/event/find"
			body: "*"
		};
	}
	rpc GetEvent(GetEventRequest) returns (GetEventReply) {
		option (google.api.http) = {
			post: "/api/v1/event/get"
			body: "*"
		};
	}
	rpc GetImage(GetImageRequest) returns (GetImageReply) {
		option (google.api.http) = {
			post: "/api/v1/image/get"
			body: "*"
		};
	}
	rpc DeleteEvent(DeleteEventRequest) returns (DeleteEventReply) {
		option (google.api.http) = {
			post: "/api/v1/event/delete"
			body: "*"
		};
	}
}

message Event {
	string id = 1;
	string eid = 2; // the first event of one alert
	int64 mid = 3; // mission id
	int64 created_at = 4;
	string type = 5;
	bool finished = 6;
	message Alert {
		string id = 1;
		int64 created_at = 2;
	}
	repeated Alert alerts = 7;
}

message FindEventsRequest {
	int64 index = 1;
	int64 size = 2;
	int64 start = 3;
	int64 end = 4;
	string type = 5;
	bool finished = 6;
	bool is_finished = 7;
}
message FindEventsReply {
	int64 index = 1;
	int64 size = 2;
	int64 page = 3;
	int64 total = 4;
	repeated Event events = 5;
}

message GetEventRequest {
	string eid = 1;
}
message GetEventReply {
	Event event = 1;
}

message GetImageRequest {
	string id = 1;
}
message GetImageReply {
	string image = 1;
}

message DeleteEventRequest {
	string eid = 1;
}
message DeleteEventReply {}